using Mirror;
using UnityEngine;

public class TopSecretServerInfo : NetworkBehaviour
{
    //This example class will be on every player, but the data will be set on the server only.
    [ReadOnly] public string SecretName;

    // DO NOT CHANGE THESE COMMENTS! vvvv They are markers, looked for exactly with reflection. vvvv
    // Secret Info Fields Start
    [ReadOnly] public byte SecretInfo1;
    [ReadOnly] public byte SecretInfo2;
    [ReadOnly] public byte SecretInfo3;
    [ReadOnly] public byte SecretInfo4;
    [ReadOnly] public byte SecretInfo5;
    [ReadOnly] public byte SecretInfo6;
    [ReadOnly] public byte SecretInfo7;
    [ReadOnly] public byte SecretInfo8;
    [ReadOnly] public byte SecretInfo9;
    [ReadOnly] public byte SecretInfo10;
    [ReadOnly] public byte SecretInfo11;
    [ReadOnly] public byte SecretInfo12;
    [ReadOnly] public byte SecretInfo13;
    [ReadOnly] public byte SecretInfo14;
    [ReadOnly] public byte SecretInfo15;
    [ReadOnly] public byte SecretInfo16;
    [ReadOnly] public byte SecretInfo17;
    [ReadOnly] public byte SecretInfo18;
    [ReadOnly] public byte SecretInfo19;
    [ReadOnly] public byte SecretInfo20;
    [ReadOnly] public byte SecretInfo21;
    [ReadOnly] public byte SecretInfo22;
    [ReadOnly] public byte SecretInfo23;
    [ReadOnly] public byte SecretInfo24;
    [ReadOnly] public byte SecretInfo25;
    [ReadOnly] public byte SecretInfo26;
    [ReadOnly] public byte SecretInfo27;
    [ReadOnly] public byte SecretInfo28;
    [ReadOnly] public byte SecretInfo29;
    [ReadOnly] public byte SecretInfo30;
    [ReadOnly] public byte SecretInfo31;
    [ReadOnly] public byte SecretInfo32;
    [ReadOnly] public byte SecretInfo33;
    [ReadOnly] public byte SecretInfo34;
    [ReadOnly] public byte SecretInfo35;
    [ReadOnly] public byte SecretInfo36;
    [ReadOnly] public byte SecretInfo37;
    [ReadOnly] public byte SecretInfo38;
    [ReadOnly] public byte SecretInfo39;
    [ReadOnly] public byte SecretInfo40;
    [ReadOnly] public byte SecretInfo41;
    [ReadOnly] public byte SecretInfo42;
    [ReadOnly] public byte SecretInfo43;
    [ReadOnly] public byte SecretInfo44;
    [ReadOnly] public byte SecretInfo45;
    [ReadOnly] public byte SecretInfo46;
    [ReadOnly] public byte SecretInfo47;
    [ReadOnly] public byte SecretInfo48;
    [ReadOnly] public byte SecretInfo49;
    [ReadOnly] public byte SecretInfo50;
    [ReadOnly] public byte SecretInfo51;
    [ReadOnly] public byte SecretInfo52;
    [ReadOnly] public byte SecretInfo53;
    [ReadOnly] public byte SecretInfo54;
    [ReadOnly] public byte SecretInfo55;
    [ReadOnly] public byte SecretInfo56;
    [ReadOnly] public byte SecretInfo57;
    [ReadOnly] public byte SecretInfo58;
    [ReadOnly] public byte SecretInfo59;
    [ReadOnly] public byte SecretInfo60;
    [ReadOnly] public byte SecretInfo61;
    [ReadOnly] public byte SecretInfo62;
    [ReadOnly] public byte SecretInfo63;
    [ReadOnly] public byte SecretInfo64;
    [ReadOnly] public byte SecretInfo65;
    [ReadOnly] public byte SecretInfo66;
    [ReadOnly] public byte SecretInfo67;
    [ReadOnly] public byte SecretInfo68;
    [ReadOnly] public byte SecretInfo69;
    [ReadOnly] public byte SecretInfo70;
    [ReadOnly] public byte SecretInfo71;
    [ReadOnly] public byte SecretInfo72;
    [ReadOnly] public byte SecretInfo73;
    [ReadOnly] public byte SecretInfo74;
    [ReadOnly] public byte SecretInfo75;
    [ReadOnly] public byte SecretInfo76;
    [ReadOnly] public byte SecretInfo77;
    [ReadOnly] public byte SecretInfo78;
    [ReadOnly] public byte SecretInfo79;
    [ReadOnly] public byte SecretInfo80;
    [ReadOnly] public byte SecretInfo81;
    [ReadOnly] public byte SecretInfo82;
    [ReadOnly] public byte SecretInfo83;
    [ReadOnly] public byte SecretInfo84;
    [ReadOnly] public byte SecretInfo85;
    [ReadOnly] public byte SecretInfo86;
    [ReadOnly] public byte SecretInfo87;
    [ReadOnly] public byte SecretInfo88;
    [ReadOnly] public byte SecretInfo89;
    [ReadOnly] public byte SecretInfo90;
    [ReadOnly] public byte SecretInfo91;
    [ReadOnly] public byte SecretInfo92;
    [ReadOnly] public byte SecretInfo93;
    [ReadOnly] public byte SecretInfo94;
    [ReadOnly] public byte SecretInfo95;
    [ReadOnly] public byte SecretInfo96;
    [ReadOnly] public byte SecretInfo97;
    [ReadOnly] public byte SecretInfo98;
    [ReadOnly] public byte SecretInfo99;
    [ReadOnly] public byte SecretInfo100;
    [ReadOnly] public byte SecretInfo101;
    [ReadOnly] public byte SecretInfo102;
    [ReadOnly] public byte SecretInfo103;
    [ReadOnly] public byte SecretInfo104;
    [ReadOnly] public byte SecretInfo105;
    [ReadOnly] public byte SecretInfo106;
    [ReadOnly] public byte SecretInfo107;
    [ReadOnly] public byte SecretInfo108;
    [ReadOnly] public byte SecretInfo109;
    [ReadOnly] public byte SecretInfo110;
    [ReadOnly] public byte SecretInfo111;
    [ReadOnly] public byte SecretInfo112;
    [ReadOnly] public byte SecretInfo113;
    [ReadOnly] public byte SecretInfo114;
    [ReadOnly] public byte SecretInfo115;
    [ReadOnly] public byte SecretInfo116;
    [ReadOnly] public byte SecretInfo117;
    [ReadOnly] public byte SecretInfo118;
    [ReadOnly] public byte SecretInfo119;
    [ReadOnly] public byte SecretInfo120;
    [ReadOnly] public byte SecretInfo121;
    [ReadOnly] public byte SecretInfo122;
    [ReadOnly] public byte SecretInfo123;
    [ReadOnly] public byte SecretInfo124;
    [ReadOnly] public byte SecretInfo125;
    [ReadOnly] public byte SecretInfo126;
    [ReadOnly] public byte SecretInfo127;
    [ReadOnly] public byte SecretInfo128;
    [ReadOnly] public byte SecretInfo129;
    [ReadOnly] public byte SecretInfo130;
    [ReadOnly] public byte SecretInfo131;
    [ReadOnly] public byte SecretInfo132;
    [ReadOnly] public byte SecretInfo133;
    [ReadOnly] public byte SecretInfo134;
    [ReadOnly] public byte SecretInfo135;
    [ReadOnly] public byte SecretInfo136;
    [ReadOnly] public byte SecretInfo137;
    [ReadOnly] public byte SecretInfo138;
    [ReadOnly] public byte SecretInfo139;
    [ReadOnly] public byte SecretInfo140;
    [ReadOnly] public byte SecretInfo141;
    [ReadOnly] public byte SecretInfo142;
    [ReadOnly] public byte SecretInfo143;
    [ReadOnly] public byte SecretInfo144;
    [ReadOnly] public byte SecretInfo145;
    [ReadOnly] public byte SecretInfo146;
    [ReadOnly] public byte SecretInfo147;
    [ReadOnly] public byte SecretInfo148;
    [ReadOnly] public byte SecretInfo149;
    [ReadOnly] public byte SecretInfo150;
    [ReadOnly] public byte SecretInfo151;
    [ReadOnly] public byte SecretInfo152;
    [ReadOnly] public byte SecretInfo153;
    [ReadOnly] public byte SecretInfo154;
    [ReadOnly] public byte SecretInfo155;
    [ReadOnly] public byte SecretInfo156;
    [ReadOnly] public byte SecretInfo157;
    [ReadOnly] public byte SecretInfo158;
    [ReadOnly] public byte SecretInfo159;
    [ReadOnly] public byte SecretInfo160;
    [ReadOnly] public byte SecretInfo161;
    [ReadOnly] public byte SecretInfo162;
    [ReadOnly] public byte SecretInfo163;
    [ReadOnly] public byte SecretInfo164;
    [ReadOnly] public byte SecretInfo165;
    [ReadOnly] public byte SecretInfo166;
    [ReadOnly] public byte SecretInfo167;
    [ReadOnly] public byte SecretInfo168;
    [ReadOnly] public byte SecretInfo169;
    [ReadOnly] public byte SecretInfo170;
    [ReadOnly] public byte SecretInfo171;
    [ReadOnly] public byte SecretInfo172;
    [ReadOnly] public byte SecretInfo173;
    [ReadOnly] public byte SecretInfo174;
    [ReadOnly] public byte SecretInfo175;
    [ReadOnly] public byte SecretInfo176;
    [ReadOnly] public byte SecretInfo177;
    [ReadOnly] public byte SecretInfo178;
    [ReadOnly] public byte SecretInfo179;
    [ReadOnly] public byte SecretInfo180;
    [ReadOnly] public byte SecretInfo181;
    [ReadOnly] public byte SecretInfo182;
    [ReadOnly] public byte SecretInfo183;
    [ReadOnly] public byte SecretInfo184;
    [ReadOnly] public byte SecretInfo185;
    [ReadOnly] public byte SecretInfo186;
    [ReadOnly] public byte SecretInfo187;
    [ReadOnly] public byte SecretInfo188;
    [ReadOnly] public byte SecretInfo189;
    [ReadOnly] public byte SecretInfo190;
    [ReadOnly] public byte SecretInfo191;
    [ReadOnly] public byte SecretInfo192;
    [ReadOnly] public byte SecretInfo193;
    [ReadOnly] public byte SecretInfo194;
    [ReadOnly] public byte SecretInfo195;
    [ReadOnly] public byte SecretInfo196;
    [ReadOnly] public byte SecretInfo197;
    [ReadOnly] public byte SecretInfo198;
    [ReadOnly] public byte SecretInfo199;
    [ReadOnly] public byte SecretInfo200;
// Secret Info Fields End
    // DO NOT CHANGE THESE COMMENTS! ^^^^ They are markers, looked for exactly with reflection. ^^^^

    public void Update() // Testing purposes of course
    {
        if (!isServer) return;
        if (!isLocalPlayer) return;
        if (Input.GetKeyDown(KeyCode.X))
        {
            Debug.Log("I am the server and I pressed X");
            SetSecretNameOfEveryone();
            SetManyFieldsForBenchmark();
        }

        if (Input.GetKeyDown(KeyCode.P))
        {
            NetworkServerDebugger.PrintAllNetworkObjects();
        }
    }

    [Command(requiresAuthority = false)]
    public void SetSecretNameOfEveryone()
    {
        foreach (var player in PlayersManager.Instance.GetClients())
        {
            string secretName = TopSecretServerInfo.GetSecretName();
            player.GetComponent<TopSecretServerInfo>().SecretName = secretName;

            Debug.Log("Name set: " + secretName);
            var ucid = player.GetComponent<MyClient>().UniqueClientIdentifier;
            HostMigrationData.Instance.AddMigrationData(
                new MigrationData(ucid, nameof(TopSecretServerInfo), nameof(SecretName), secretName));
        }
    }

    [Command(requiresAuthority = false)]
    public void SetManyFieldsForBenchmark()
    {
        foreach (var player in PlayersManager.Instance.GetClients())
        {
            var playerInfo = player.GetComponent<TopSecretServerInfo>();
            var ucid = player.GetComponent<MyClient>().UniqueClientIdentifier;

            for (int i = 1; i <= BenchmarkManager.AmountOfExtraServerDatas; i++) // this is one REALLY expensive method, please don't do this in your actual games
            {
                byte newByte = GetRandomByte();

                // Use reflection to get the field dynamically by name
                var fieldName = $"SecretInfo{i}";
                var field = typeof(TopSecretServerInfo).GetField(fieldName);

                if (field != null && field.FieldType == typeof(byte))
                {
                    field.SetValue(playerInfo, newByte); // Set the value of the field

                    HostMigrationData.Instance.AddMigrationData(
                        new MigrationData(ucid, nameof(TopSecretServerInfo), fieldName, newByte));
                }
                else
                {
                    Debug.LogWarning($"Field '{fieldName}' not found or is not of type byte.");
                }
            }
        }
    }

    public static string GetSecretName()
    {
        var random = Random.Range(1, 10);
        return random switch
        {
            1 => "John",
            2 => "Bob",
            3 => "Jef",
            4 => "Fries",
            5 => "Sara",
            6 => "Louis",
            7 => "Cedric",
            8 => "Alexander",
            9 => "Filou",
            _ => throw new System.NotImplementedException(),
        };
    }

    public static byte GetRandomByte()
    {
        System.Random random = new();
        byte newByte = (byte)random.Next(0, 255);
        return newByte;
    }
}
